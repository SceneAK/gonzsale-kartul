<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Catalog</title>
    <style>
        /* Body and general styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .catalog {
            padding: 20px;
        }

        /* Tab links */
        .tablink {
            background-color: #f9f9f9;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .tablink:hover {
            background-color: #ddd;
        }

        /* Tab content */
        .tabcontent {
            display: none;
            padding: 20px;
            background-color: #fff;
        }

        .item {
            display: inline-block;
            margin: 10px;
            text-align: center;
        }

        .item img {
            width: 150px;
            height: 150px;
        }

        .item p {
            font-size: 16px;
        }

        /* Active class for the selected tablink */
        .active {
            background-color: #ff9900;
            color: white;
        }
    </style>
</head>

<body>
    <!-- Header section -->
    <div id="header"></div>

    <!-- Main content -->
    <div class="catalog">
        <h1>Item Catalog</h1>

        <!-- Category Contents -->
        <div id="Shirts" class="tabcontent">
            <div id="shirt-items-container"></div>
        </div>

        <div id="Pants" class="tabcontent">
            <div id="pant-items-container"></div>
        </div>

        <div id="Accessories" class="tabcontent">
            <div id="accessory-items-container"></div>
        </div>

        <div id="Food" class="tabcontent">
            <div id="food-items-container">
            </div>
        </div>


        <div id="Drinks" class="tabcontent">
            <div id="drink-item-container"></div>
        </div>

        <div id="All" class="tabcontent">
            <div id="all-items-container"></div>
        </div>
    </div>

    <!-- Footer section -->
    <div id="footer"></div>

    <script>
        // Dynamic loading of header with hash-based navigation
        document.addEventListener("DOMContentLoaded", function () {
            // Dynamically load the header
            fetch('header.html')
                .then(response => {
                    if (!response.ok) throw new Error('Failed to load header');
                    return response.text();
                })
                .then(headerHTML => {
                    // Insert the header into the document
                    document.getElementById('header-container').innerHTML = headerHTML;

                    // No need to add extra event listeners since buttons use hash-based navigation
                    handleHashChange(); // Ensure the right tab is displayed after loading the header
                })
                .catch(error => console.error('Error loading header:', error));
        });

        // Mock data for testing
        const mockData = {
            shirts: [
                { product_name: "Cool T-Shirt", product_price: 99000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "piece" },
                { product_name: "Graphic Tee", product_price: 119000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "piece" },
            ],
            pants: [
                { product_name: "Jeans", product_price: 199000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "pair" },
                { product_name: "Chinos", product_price: 179000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "pair" },
            ],
            accessories: [
                { product_name: "Sunglasses", product_price: 79000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "piece" },
                { product_name: "Cap", product_price: 49000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "piece" },
            ],
            food: [
                { product_name: "Nasi Goreng", product_price: 35000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "plate" },
                { product_name: "Mie Goreng", product_price: 25000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "plate" },
            ],
            drinks: [
                { product_name: "Iced Coffee", product_price: 20000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "cup" },
                { product_name: "Milk Tea", product_price: 18000, product_imgSrc: "https://via.placeholder.com/150", product_unit: "cup" },
            ],
        };

        // Function to fetch items from API or use mock data
        async function fetchItems(category, containerId) {
            try {
                const container = document.getElementById(containerId);

                // Display a loading message while fetching
                container.innerHTML = `<p>Loading ${category} items...</p>`;

                // Attempt to fetch data from API
                const response = await fetch(`http://localhost:3000/product/${category}`);
                if (!response.ok) throw new Error(`Failed to fetch ${category} items`);

                // Parse response and clear container
                const items = await response.json();
                populateItems(container, items);
            } catch (error) {
                console.error(`Error fetching ${category} items:`, error);

                // Use mock data in case of fetch failure
                const items = mockData[category] || [];
                const container = document.getElementById(containerId);
                populateItems(container, items);
            }
        }

        // Function to populate items in the container
        function populateItems(container, items) {
            container.innerHTML = ''; // Clear the container

            items.forEach(item => {
                const itemDiv = document.createElement("div");
                itemDiv.classList.add("item");

                itemDiv.innerHTML = `
                    <img src="${item.product_imgSrc}" alt="${item.product_name}" />
                    <p>${item.product_name} - Rp ${item.product_price.toLocaleString('id-ID')} / ${item.product_unit}</p>
                    <button class="add-to-cart" onclick="addToCart('${item.product_name}', ${item.product_price}, '${item.product_imgSrc}')">Add to Cart</button>
                `;
                container.appendChild(itemDiv);
            });
        }

        // Function to add items to the cart
        function addToCart(name, price, imgSrc) {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existingItemIndex = cart.findIndex(item => item.name === name);

            if (existingItemIndex > -1) {
                // If item already exists in the cart, increase its quantity
                cart[existingItemIndex].quantity += 1;
            } else {
                // Add new item to the cart
                cart.push({ name, price, imgSrc, quantity: 1 });
            }

            localStorage.setItem('cart', JSON.stringify(cart)); // Save updated cart
            alert(`${name} has been added to your cart!`);
        }

        // Handle switching between tabs using hash-based navigation
        function openCategory(categoryName) {
            const tabcontents = document.getElementsByClassName("tabcontent");

            // Hide all tab contents
            Array.from(tabcontents).forEach(tab => (tab.style.display = "none"));

            // Show the selected tab's content
            const selectedTab = document.getElementById(categoryName);
            if (selectedTab) {
                selectedTab.style.display = "block";

                // Fetch items dynamically
                const containerId = `${categoryName.toLowerCase()}-items-container`;
                fetchItems(categoryName.toLowerCase(), containerId);
            }
        }

        // Handle hash changes to navigate between tabs
        function handleHashChange() {
            const hash = window.location.hash.substring(1); // Remove the '#' from the hash
            if (hash) {
                openCategory(hash);
            } else {
                // Default to the "Shirts" tab if no hash is present
                openCategory("Shirts");
            }
        }

        // Automatically load content for all categories on page load
        document.addEventListener("DOMContentLoaded", function () {
            const categories = {
                Shirts: "shirt-items-container",
                Pants: "pant-items-container",
                Accessories: "accessory-items-container",
                Food: "food-items-container",
                Drinks: "drink-item-container",
                All: "all-items-container",
            };

            // Fetch items for each category
            for (const [category, containerId] of Object.entries(categories)) {
                fetchItems(category.toLowerCase(), containerId);
            }

            // Attach event listener for hash changes
            window.addEventListener("hashchange", handleHashChange);

            // Trigger the handler on page load
            handleHashChange();
        });
    </script>

    <script src="dropdown.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            initializePage(); // Initialize the shared functionality
        });
    </script>
</body>

</html>