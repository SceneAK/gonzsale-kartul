<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard</title>
  <style>
    /* Basic Reset & Typography */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    body {
      background-color: #f4f7f9;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 1rem;
      background: #fff;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1, h2 {
      margin-bottom: 1rem;
      color: #444;
    }

    section {
      margin-bottom: 2rem;
    }

    /* Form Styling */
    form {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    form label {
      font-weight: bold;
    }

    form input[type="text"],
    form select {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    form button {
      padding: 0.5rem 1rem;
      border: none;
      background-color: #007bff;
      color: #fff;
      border-radius: 3px;
      cursor: pointer;
    }

    form button:hover {
      background-color: #0056b3;
    }

    /* Table Styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }

    table th, table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    table tbody tr:hover {
      background-color: #f1f1f1;
    }

    /* Button for Raw HTTP Requests */
    #raw-http-section {
      text-align: center;
      margin-top: 2rem;
    }

    #rawHttpButton {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border: none;
      background-color: #28a745;
      color: #fff;
      border-radius: 3px;
      cursor: pointer;
    }

    #rawHttpButton:hover {
      background-color: #1e7e34;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin Dashboard</h1>
    
    <!-- User Role Granting Panel -->
    <section id="user-role-panel">
      <h2>User Role Granting Panel</h2>
      <form id="roleForm">
        <label for="username">Username:</label>
        <input type="text" id="email" name="email" placeholder="Enter email" required>
        
        <label for="role">Select Role:</label>
        <select id="role" name="role">
          <option value="STORE_MANAGER">STORE_MANAGER</option>
          <option value="ADMIN">ADMIN</option>
        </select>
        
        <button type="submit">Grant Role</button>
      </form>
      <div id="roleMessage"></div>
    </section>
    
    <!-- Pending Orders Panel -->
    <section id="pending-orders-panel">
      <h2>Pending Orders</h2>
      <table id="pendingOrdersTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Store</th>
            <th>Customer</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <!-- Pending orders will be inserted here by JavaScript -->
        </tbody>
      </table>
    </section>
    
    <!-- Store Panel -->
    <section id="store-panel">
      <h2>Stores</h2>
      <table id="storesTable">
        <thead>
          <tr>
            <th>Store ID</th>
            <th>Store Name</th>
            <th>Location</th>
          </tr>
        </thead>
        <tbody>
          <!-- Store list will be inserted here by JavaScript -->
        </tbody>
      </table>
    </section>
    
    <!-- Raw HTTP Requests Button -->
    <section id="raw-http-section">
      <button id="rawHttpButton">Go to Raw HTTP Requests</button>
    </section>
  </div>
  
  <script type="module">
    import {user, store} from './integration/fetches.js';
    // Handle User Role Granting Form Submission
    document.getElementById('roleForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const role = document.getElementById('role').value;

      const result = await user.fetchUsers({email});
      const userWithEmail = result.items?.[0];
      if(!userWithEmail) throw new Error("No user with such email");
      
      console.log(userWithEmail)
      await user.grantRole(userWithEmail.id, role);
      document.getElementById('roleMessage').textContent = 'Granted ' + role + ' role to ' + userWithEmail.name;
      // Reset the form fields
      this.reset();
    });
    
    // Dummy Data for Pending Orders
    const pendingOrders = [
      { id: 'ORD001', store: 'Store A', customer: 'John Doe', total: '$100.00' },
      { id: 'ORD002', store: 'Store B', customer: 'Jane Smith', total: '$150.00' },
      { id: 'ORD003', store: 'Store C', customer: 'Alice Johnson', total: '$200.00' }
    ];
    
    const ordersTableBody = document.querySelector('#pendingOrdersTable tbody');
    pendingOrders.forEach(order => {
      const row = document.createElement('tr');
      row.innerHTML = '<td>' + order.id + '</td>' +
                      '<td>' + order.store + '</td>' +
                      '<td>' + order.customer + '</td>' +
                      '<td>' + order.total + '</td>';
      ordersTableBody.appendChild(row);
    });
    
    // Dummy Data for Stores
    const stores = [
      { id: '1', name: 'Store A', location: 'New York' },
      { id: '2', name: 'Store B', location: 'Los Angeles' },
      { id: '3', name: 'Store C', location: 'Chicago' }
    ];
    
    const storesTableBody = document.querySelector('#storesTable tbody');
    stores.forEach(store => {
      const row = document.createElement('tr');
      row.style.cursor = 'pointer';
      row.innerHTML = '<td>' + store.id + '</td>' +
                      '<td>' + store.name + '</td>' +
                      '<td>' + store.location + '</td>';
      row.addEventListener('click', function() {
        // Redirect to the store analytics page with a query parameter for the store id
        window.location.href = 'storeAnalytics.html?storeId=' + store.id;
      });
      storesTableBody.appendChild(row);
    });
    
    // Event Listener for "Raw HTTP Requests" Button
    document.getElementById('rawHttpButton').addEventListener('click', function() {
      window.location.href = 'raw.html';
    });
  </script>
</body>
</html>
